<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Detail Spesies</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { font-family: Arial, sans-serif; margin:20px; line-height:1.6; }
    h1 { color: #2e7d32; }
    #map { height: 400px; margin-top: 15px; border-radius: 8px; }
    .gallery img { max-width: 200px; border-radius: 8px; margin: 5px; }
    .taxonomy { background: #f0fff0; padding: 15px; border-radius: 8px; margin: 15px 0; }
    .taxonomy table { border-collapse: collapse; width: 100%; }
    .taxonomy td { padding: 5px; border-bottom: 1px solid #ddd; }
    .taxonomy td:first-child { font-weight: bold; width: 120px; }
  </style>
</head>
<body>
  <h1 id="namaSpesies"></h1>
  <h3 id="familiGenus"></h3>

  <!-- Taksonomi -->
  <div class="taxonomy">
    <h2>Taksonomi</h2>
    <table id="tabelTaksonomi"></table>
  </div>

  <!-- Deskripsi -->
  <p><b>Deskripsi:</b> <span id="deskripsi"></span></p>

  <!-- Foto -->
  <div class="gallery" id="fotoGallery"></div>

  <!-- Peta -->
  <h2>Peta Sebaran</h2>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Ganti dengan ID Google Sheets kamu (File > Bagikan > Publikasikan ke web > CSV)
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-XXXXX/pub?output=csv";

    async function loadData() {
      let response = await fetch(sheetUrl);
      let text = await response.text();

      // parsing CSV sederhana
      let rows = text.split("\n").map(r => r.split(","));
      let header = rows[0];
      let data = rows[1]; // ambil baris pertama data

      let obj = {};
      header.forEach((h, i) => { obj[h.trim()] = data[i] });

      // Set Judul
      document.getElementById("namaSpesies").textContent = obj["Spesies"];
      document.getElementById("familiGenus").innerHTML = `<i>${obj["Genus"]}</i> (${obj["Famili"]})`;

      // Isi Taksonomi
      let taksonomi = [
        ["Kingdom", obj["Kingdom"]],
        ["Phylum", obj["Phylum"]],
        ["Class", obj["Class"]],
        ["Order", obj["Order"]],
        ["Family", obj["Famili"]],
        ["Genus", obj["Genus"]],
        ["Spesies", obj["Spesies"]]
      ];

      let tableHTML = taksonomi.map(t => `<tr><td>${t[0]}</td><td>${t[1]}</td></tr>`).join("");
      document.getElementById("tabelTaksonomi").innerHTML = tableHTML;

      // Deskripsi
      document.getElementById("deskripsi").textContent = obj["Deskripsi"];

      // Foto
      if (obj["Foto URL"]) {
        let fotos = obj["Foto URL"].split(";");
        fotos.forEach(f => {
          let img = document.createElement("img");
          img.src = f.trim();
          document.getElementById("fotoGallery").appendChild(img);
        });
      }

      // Peta
      var map = L.map('map').setView([0, 117], 6);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
      }).addTo(map);

      if (obj["Koordinat"]) {
        let coords = obj["Koordinat"].split(";");
        coords.forEach(c => {
          let parts = c.trim().split(",");
          if (parts.length === 2) {
            L.marker([parseFloat(parts[0]), parseFloat(parts[1])]).addTo(map);
          }
        });
      }

      if (obj["GeoJSON URL"]) {
        fetch(obj["GeoJSON URL"])
          .then(res => res.json())
          .then(data => {
            L.geoJSON(data, {style:{color:"green",fillOpacity:0.3}}).addTo(map);
          });
      }
    }

    loadData();
  </script>
</body>
</html>
